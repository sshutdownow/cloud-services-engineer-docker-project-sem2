# Проектная работа дисциплины «Docker-контейнеризация и хранение данных»

## Описание
В этой проектной работе нужно настроить контейнеризацию существующего приложения с использованием Docker и Docker Compose, а также обеспечить безопасность образов и контейнеров.

Изначально в проекте две части:
* backend — бэкенд приложения (Go).
* frontend — фронтенд приложения (Vue.js).

В рамках проекта выполнены следующие задачи:
* Оптимизированы Dockerfile для:
  * бэкенда: go-приложение собрано статически, для его запуска используется [пустой контейнер](https://hub.docker.com/_/scratch/), для healtheck добавленно [простое приложение на go](backend/cmd/healthcheck), тоже слинкованно статически. Размер образа после развёртывания - 16.5MB.
  * фронтенд: в качестве основы взят легковесный образ nginx:stable-alpine, применена мультиэтапнная сборка и создан [.dockerignore](https://cli.vuejs.org/ru/guide/deployment.html#docker-nginx). Размер образа после развёртывания 53.6MB.
* Добавлен ещё один контейнер - `gateway`, он использует image `haproxy:lts-alpine` (размер на диске 32.3MB), `gateway` выполняет функцию балансировщика нагрузки. Он [использует DNS-резолвер докера для обнаружения](https://www.haproxy.com/blog/haproxy-on-docker-swarm-load-balancing-and-dns-service-discovery) добавления/удаления backend-серверов. Т.е. если мы меняем число экземпляров контейнеров go-бэкенд и/или и vue-фронтенд, haproxy это тут же обнаруживает и начинает распределять нагрузку по всем рабочим контейнерам. Это позволяет быстро адаптировать проект под изменения нагрузки. `haproxy` использует проверки работоспособности сервисов в остальных контейнерах и в случае сбоя или отказа, исключает его из алгоритма балансировки.
* Настроен Docker Compose для оркестрации контейнеров:
  * описаны все сервисы: `backend`, `frontend` и `gateway`.
  * обработка перезапуска и healthchecks.
  * `gateway` запускается только по готовности `backend`, `frontend`.
  * реализована горизонтальная масштабируемость с балансировкой нагрузки
* Реализованы меры безопасности:
  * `gateway` - это единственный контейнер, который доступен напрямую из внешней сети (Интернет), с остальными контейнерами он коммуницирует в рамках отдельной внутренней сети.
  * Внутри всех контейнеров нет процессов, запущенных от root.
  * Чувствительная информация исключена из образов.
  * В [workflow](.github/workflows/deploy.yaml) добавленно сканирование образов на уязвимости с помощью trivy.
  * Настроены ограничения ресурсов (CPU, память) и политики перезапуска.
  * Основная ФС в контейнерах монтируется в режиме только для чтения, для сохранения данных настроены volumes.

  
